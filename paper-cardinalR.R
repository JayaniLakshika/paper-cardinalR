# Generated by `rjournal_pdf_article()` using `knitr::purl()`: do not edit by hand
# Please edit paper-cardinalR.Rmd to modify this file

## ----setup, include=FALSE-----------------------------------------------------
options(repos = "https://cloud.r-project.org") ## set up CRAN mirror
knitr::opts_chunk$set(
  echo = FALSE,
  cache=FALSE, 
  message=FALSE, 
  warning=FALSE,
  out.width = "100%",
  fig.pos = "!")



## ----set-seed-----------------------------------------------------------------
set.seed(20240412)


## ----load-libraries-----------------------------------------------------------
library(cardinalR)
library(tidyverse)
library(kableExtra)
library(geozoo)
library(patchwork)
library(colorspace)
library(crosstalk)
library(fpc)
library(mclust)
library(htmltools)


## -----------------------------------------------------------------------------
#| label: plot-theme
theme_set(theme_linedraw() +
   theme(
     aspect.ratio = 1,
     plot.background = element_rect(fill = 'transparent', colour = NA),
     plot.title = element_text(size = 7, hjust = 0.5, vjust = -0.5),
     panel.background = element_rect(fill = 'transparent', 
                                     colour = NA),
     panel.grid.major = element_blank(), 
     panel.grid.minor = element_blank(), 
     axis.title.x = element_blank(), axis.title.y = element_blank(),
     axis.text.x = element_blank(), axis.ticks.x = element_blank(),
     axis.text.y = element_blank(), axis.ticks.y = element_blank(),
     legend.background = element_rect(fill = 'transparent', 
                                      colour = NA),
     legend.key = element_rect(fill = 'transparent', 
                               colour = NA),
     legend.position = "bottom", 
     legend.title = element_blank(), 
     legend.text = element_text(size=4),
     legend.key.height = unit(0.25, 'cm'),
     legend.key.width = unit(0.25, 'cm'),
     plot.margin = margin(0, 0, 0, 0)
   )
)


## -----------------------------------------------------------------------------
#| label: import-scripts
source("scripts/additional_functions.R")


## ----workflow, out.width = "80%", fig.align='center', fig.cap="Workflow for generating high-dimensional clustered data. The user specifies input parameters such as the number of points ($n$), number of clusters ($k$), cluster locations, shapes, scaling, rotations, and optional background noise. Each cluster shape is generated by a shape generator, optionally rotated or scaled, and combined into a single dataset. Additional background noise can be added, and each observation is labeled by shape.", fig.alt="Workflow for generating high-dimensional clustered data, from specifying input parameters to producing the final labeled dataset with optional noise dimensions.", fig.pos="!ht"----

knitr::include_graphics("figures/cardinalR_workflow.png")


## ----echo=TRUE----------------------------------------------------------------
clust_data <- gen_multicluster(
  n = c(200, 300, 500),
  k = 3,
  loc = matrix(c(
    0, 0, 0, 0,
    5, 9, 0, 0,
    3, 4, 10, 7
  ), nrow = 3, byrow = TRUE),
  scale = c(3, 1, 2),
  shape = c("gaussian", "cone", "unifcube"),
  is_bkg = FALSE
)


## -----------------------------------------------------------------------------
main_tb <- tibble(arg = c("n",
                          "k",
                          "loc",
                          "scale",
                          "shape",
                          "rotation",
                          "is_bkg"),
                  type = c("numeric (vector)",
                           "numeric",
                           "numeric (matrix)",
                           "numeric (vector)",
                           "character (vector)",
                           "numeric (list)",
                           "boolean"),
                        exp = c("Number of points in each cluster.",
                                "Number of clusters.",
                                "Locations/centroids of clusters.",
                                "Scaling factors of clusters.",
                                "Shapes of clusters.",
                                "Rotation matrices, one per cluster.",
                                "Background noise should exist or not.")) |> 
    mutate(arg = gsub("_", "\\\\_", arg))


## ----main-tb-html, eval=knitr::is_html_output()-------------------------------
# main_tb |>
#   mutate(arg = paste0("<code>", arg, "</code>")) |>
#   kable(caption = "The main arguments for `gen_multicluster()`.", col.names = c("Argument", "Type", "Explanation"), linesep = "", escape = FALSE, table.pos = "!ht")


## ----main-tb-pdf, eval=knitr::is_latex_output()-------------------------------
main_tb |> 
    mutate(arg = paste0("\\texttt{", arg, "}")) |> 
  kable(caption = "The main arguments for \\texttt{gen\\_multicluster()}.", format="latex", col.names = c("Argument", "Type", "Explanation"), booktabs = T, table.pos = "!ht", linesep = "", escape = FALSE)  |>
  column_spec(1, width = "2cm") |>
  column_spec(2, width = "3cm") |>
  column_spec(3, width = "8cm")


## -----------------------------------------------------------------------------
shape_tb <- tibble(fun = c("gen_expbranches",
                             "gen_linearbranches",
                             "gen_curvybranches", 
                             "gen_orglinearbranches", 
                             "gen_orgcurvybranches",
                             "gen_cone",
                             "gen_gridcube",
                             "gen_unifcube",
                            "gen_gaussian",
                            "gen_longlinear",
                            "gen_mobius",
                            "gen_quadratic",
                             "gen_cubic",
                            "gen_pyrrect",
                             "gen_pyrtri",
                             "gen_pyrstar",
                             "gen_pyrfrac",
                            "gen_scurve",
                            "gen_circle",
                            "gen_curvycycle",
                            "gen_unifsphere",
                            "gen_hollowsphere",
                            "gen_gridedsphere",
                            "gen_clusteredspheres",
                            "gen_hemisphere",
                            "gen_swissroll",
                            "gen_trefoil4d",
                            "gen_trefoil3d",
                             "gen_crescent",
                            "gen_curvycylinder",
                            "gen_sphericalspiral",
                            "gen_helicalspiral",
                            "gen_conicspiral",
                            "gen_nonlinear"),
                    parm = c("n, k",
                             "n, k",
                             "n, k",
                             "n, p, k",
                             "n, p, k",
                             "n, p, h, ratio",
                             "n, p",
                             "n, p",
                             "n, p, s",
                             "n, p",
                             "n",
                             "n",
                             "n",
                             "n, p",
                             "n, p",
                             "n, p",
                             "n, p",
                              "n",
                             "n, p",
                             "n, p",
                             "n, r",
                             "n, p",
                             "n",
                             "n, k, r, loc",
                             "n, p",
                             "n, w",
                             "n, steps",
                             "n, steps",
                             "n", 
                             "n, h", 
                             "n, spins", 
                             "n", 
                             "n, spins", 
                             "n, hc, non_fac"),
                      exp = c("Exponential shaped branches.",
                               "Linear shaped branches.", 
                               "Curvy shaped branches.",
                               "Linear shaped branches originated in one point.",
                               "Curvy shaped branches originated in one point.",
                               "Cone-shaped structure.",
                              "Cube with specified grid points along each axes.",
                              "Cube with uniform points.",
                              "Multivariate Gaussian cloud.",
                              "Long linear structure.",
                              "Möbius strip in $3\text{-}D$.",
                              "Quadratic pattern in $2\text{-}D$.",
                                "Cubic pattern in $2\text{-}D$.",
                              "Rectangular-base, with a sharp or blunted apex.",
          "Triangular-base, with a sharp or blunted apex.",
          "Star-shaped base, with a sharp or blunted apex.",
          "Pyramid with triangular pyramid-shaped holes.",
          "S-curve in $3\text{-}D$.",
          "Circle.",
                                "Curvy cell cycle.",
                                "Uniform ball.",
                                "Hollow sphere.",
                                "Grided sphere.",
                                "Multiple small spheres within a big sphere.",
                                "Hemisphere.",
          "Swissroll structure.",
          "Trefoil in $4\\text{-}D$.", 
          "Trefoil in $3\\text{-}D$.",
          "Crescent pattern.",
                                "Curvy cylinder.",
                                "Spherical spiral.",
                                "Helical spiral.",
                                "Conic spiral.",
                                "Nonlinear hyperbola.")) |> 
   mutate(fun = gsub("_", "\\\\_", fun)) |> 
   mutate(parm = gsub("_", "\\\\_", parm))


## ----shape-tb-html, eval=knitr::is_html_output()------------------------------
# shape_tb |>
#   mutate(parm = paste0("<code>", parm, "</code>")) |>
#   mutate(fun = paste0("<code>", fun, "</code>")) |>
#   kable(caption = "Overview of shape-generation functions, including their required parameters and a brief description of each geometric structure produced. The generators cover branching patterns, spheres, spirals, pyramids, Gaussian clouds, and other nonlinear shapes.", col.names = c("Function", "Arguments", "Explanation"), escape = FALSE, table.pos = "!ht")


## ----shape-tb-pdf, eval=knitr::is_latex_output()------------------------------
shape_tb |>
  mutate(parm = paste0("\\texttt{", parm, "}")) |>
  mutate(fun = paste0("\\texttt{", fun, "}")) |> 
  kable(caption = "Overview of shape-generation functions, including their required parameters and a brief description of each geometric structure produced. The generators cover branching patterns, spheres, spirals, pyramids, Gaussian clouds, and other nonlinear shapes.", format="latex", col.names = c("Function", "Arguments", "Explanation"), escape = FALSE, booktabs = T, table.pos = "!ht", linesep = "")  |>
  column_spec(1, width = "3.5cm") |>
  column_spec(2, width = "1.5cm") |>
  column_spec(3, width = "8cm")


## -----------------------------------------------------------------------------
arg_branching_tb <- tibble(arg = c("n", "k", "p", "h", "ratio", "s", "r", "n_vec", "k_small", "r_vec", "spe", "w", "steps", "spins", "hc", "non_fac"), 
                          type = c("integer", "integer", "integer", "real value",
                                   "real value", "real value", "real value", "integers", "integer", "real values", "real value", "real value", "integer", "integer", "real value", "real value"),
                        exp = c("Number of points.",
                                "Number of clusters.",
                                "Number of dimensions.",
                                "Height.",
                                "Radius tip to radius base ratio.",
                                "Variance-covariance matrix.",
                                "Radius.",
                                "Sample sizes of the big and small spheres",
                                "Number of small spheres.",
                                "Radius of the big and small spheres.",
                                "How far apart the small spheres are placed.",
                                "Vertical variation",
                                "Number of steps for the theta parameter.",
                                "Number of loops of the spiral.",
                                "Steepness and vertical scaling of the hyperbola.",
                                "Strength of this sinusoidal effect.")) |> 
   mutate(arg = gsub("_", "\\\\_", arg))


## ----arg-shape-tb-html, eval=knitr::is_html_output()--------------------------
# arg_branching_tb |>
#   mutate(arg = paste0("<code>", arg, "</code>")) |>
#   kable(caption = "Argument definitions for the shape generators. The table lists each argument, its data type, and a description of its role in controlling geometric structure, dimensionality, scaling, curvature, spacing, and other features of the simulated high-dimensional datasets.", col.names = c("Argument", "Type (positive)", "Explanation"), escape = FALSE, table.pos = "!ht")


## ----arg-shape-tb-pdf, eval=knitr::is_latex_output()--------------------------
arg_branching_tb |> 
  mutate(arg = paste0("\\texttt{", arg, "}")) |> 
  kable(caption = "Argument definitions for the shape generators. The table lists each argument, its data type, and a description of its role in controlling geometric structure, dimensionality, scaling, curvature, spacing, and other features of the simulated high-dimensional datasets.", format="latex", col.names = c("Argument", "Type (positive)", "Explanation"), booktabs = T, escape = FALSE, table.pos = "!ht")  |>
  column_spec(1, width = "1cm") |>
  column_spec(1, width = "2cm") |>
  column_spec(2, width = "3cm")


## ----data-linearbranches------------------------------------------------------
linearbranches <- gen_linearbranches(n = 1000, k = 4)


## ----data-curvybranches-------------------------------------------------------
curvybranches <- gen_curvybranches(n = 1000, k = 4)


## ----data-expbranches---------------------------------------------------------
expbranches <- gen_expbranches(n = 1000, k = 4)


## ----data-orglinearbranches---------------------------------------------------
orglinearbranches <- gen_orglinearbranches(n = 1000, p = 4, k = 4)


## -----------------------------------------------------------------------------
orglinearbranches_lang <- langevitour::langevitour(orglinearbranches, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----orglinearbranches-proj1--------------------------------------------------
scaled_data <- scale_data_manual(orglinearbranches)

## First projection
projection <- cbind(
    c(-0.083573,-0.019043,0.006574,-0.035774),
    c(0.005380,0.068541,-0.030810,-0.054717))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.8, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.15,
                                              axis_scaled = 10, 
                                              axis_pos_x = -0.12, 
                                              axis_pos_y = -0.12, 
                                              threshold = 0.015))

orglinearbranches_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.15, 0.15), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----orglinearbranches-proj2--------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

orglinearbranches_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.6), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----orglinearbranches-proj3--------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.4, 
                                              axis_pos_y = -0.4, 
                                              threshold = 0.016))

orglinearbranches_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.5, 0.62), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-orgcurvybranches----------------------------------------------------
orgcurvybranches <- gen_orgcurvybranches(n = 1000, p = 4, k = 4)


## ----branch, eval=knitr::is_html_output(), fig.cap="Viewing the $4\\text{-}D$ `orgcurvybranches` data. The tour view shows how the linear branches appear from multiple viewing angles.", fig.alt="Interactive langevitour of the orglinearbranches dataset in $4\\text{-}D$, showing linear branches from multiple viewing angles.", fig.pos="!ht", layout="l-body"----
# 
# branchfig <- bscols(
#   htmltools::div(
#     style = "display: grid; grid-template-columns: 1fr;
#     gap: 0px;
#     align-items: start;
#     justify-items: center;
#     margin: 0;
#     padding: 0;",
#     orglinearbranches_lang
#   ),
#   device = "xs"
# )
# 
# class(branchfig) <- c(class(branchfig), "htmlwidget")
# 
# branchfig


## ----branch-proj, eval=knitr::is_latex_output(), fig.cap="Three $2\\text{-}D$ projections from the $4\\text{-}D$ \\texttt{orgcurvybranches} data. Each shows a different projection, illustrating how the linear branches appear from multiple viewing angles. These views highlight the dataset’s underlying branching structure and demonstrate how projections reveal patterns that are otherwise hidden in higher dimensions.", fig.width=12, fig.height=4, fig.pos="H", fig.alt="Three $2\\text{-}D$ projections of the $4\\text{-}D$ orglinearbranches dataset, showing different angles of the linear branches to illustrate the branching structure.", fig.pos="!ht"----

orglinearbranches_proj1 + orglinearbranches_proj2 + orglinearbranches_proj3 +
  plot_layout(ncol = 3, guides = "collect") 


## ----data-bluntedcone---------------------------------------------------------
cone <- gen_cone(n = 1000, p = 4, h = 5, ratio = 0.5)


## -----------------------------------------------------------------------------
cone_lang <- langevitour::langevitour(cone, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----cone-proj1---------------------------------------------------------------
scaled_data <- scale_data_manual(cone)

## First projection
projection <- cbind(
  c(0.22417,-0.02943,-0.02870,0.08418),
  c(-0.02715,0.18019,0.05053,0.15254))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.25,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.2, 
                                              axis_pos_y = -0.2, 
                                              threshold = 0.022))

cone_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.25, 0.25), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----cone-proj2---------------------------------------------------------------

## Second projection
projection <- cbind(
    c(0.15591,0.17907,0.03198,0.04496),
    c(-0.15376,0.10435,0.15766,0.00547))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.1,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.08, 
                                              axis_pos_y = -0.08, 
                                              threshold = 0.01))

cone_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.1, 0.12), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----cone-proj3---------------------------------------------------------------

## Third projection
projection <- cbind(
    c(-0.13548,0.13832,0.05991,-0.13544),
    c(0.08479,-0.10719,-0.01572,-0.20123))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.25,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.25, 
                                              axis_pos_y = -0.25, 
                                              threshold = 0.016))

cone_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.3, 0.2), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----cone, eval=knitr::is_html_output(), fig.cap="Viewing the $3\\text{-}D$ output  of `cone` data. Points are concentrated near the tip along the height dimension, while the radius of the hyperspherical cross-section decreases linearly toward the apex.", fig.alt="Interactive langevitour of the cone dataset in 3-D, showing points concentrated near the tip with radius decreasing linearly toward the apex.", fig.pos="!ht"----
# 
# conefig <- bscols(
#   htmltools::div(
#     style = "display: grid; grid-template-columns: 1fr;
#     gap: 0px;
#     align-items: start;
#     justify-items: center;
#     margin: 0;
#     padding: 0;",
#     cone_lang
#   ),
#   device = "xs"
# )
# 
# class(conefig) <- c(class(conefig), "htmlwidget")
# 
# conefig


## ----cone-proj, eval=knitr::is_latex_output(), fig.cap="Three $2\\text{-}D$ projections from the $3\\text{-}D$ \\texttt{cone} data. Points are concentrated near the tip along the height dimension, while the radius of the hyperspherical cross-section decreases linearly toward the apex. These projections show how the conical geometry is preserved.", fig.pos="H", fig.alt="Three $2\\text{-}D$ projections of the 3-D cone dataset, showing points concentrated near the tip and the linear decrease in radius toward the apex.", fig.pos="!ht", fig.width=12, fig.height=4----

cone_proj1 + cone_proj2 + cone_proj3 +
  plot_layout(ncol = 3, guides = "collect") 


## ----data-gridcube------------------------------------------------------------
gridcube <- gen_gridcube(n = 1000, p = 4)


## ----data-unifcube------------------------------------------------------------
unifcube <- gen_unifcube(n = 1000, p = 4)


## ----data-gau-----------------------------------------------------------------
gau <- gen_gaussian(n = 1000, p = 4, s = diag(4))


## ----data-linear--------------------------------------------------------------
linear <- gen_longlinear(n = 1000, p = 4)


## ----data-mobius--------------------------------------------------------------
mobius <- gen_mobius(n = 1000)


## ----data-quadratic-----------------------------------------------------------
quadratic <- gen_quadratic(n = 1000)


## ----data-cubic---------------------------------------------------------------
cubic <- gen_cubic(n = 1000)


## ----data-pyrrect-------------------------------------------------------------
pyrrect <- gen_pyrrect(n = 1000, p = 4)


## -----------------------------------------------------------------------------
pyrrect_lang <- langevitour::langevitour(pyrrect, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----pyrrect-proj1------------------------------------------------------------
scaled_data <- scale_data_manual(pyrrect)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.022))

pyrrect_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.65, 0.5), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrrect-proj2------------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.7, 
                                              axis_pos_x = -0.45, 
                                              axis_pos_y = -0.45, 
                                              threshold = 0.08))

pyrrect_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.6, 0.6), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrrect-proj3------------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.4, 
                                              axis_pos_y = -0.4, 
                                              threshold = 0.016))

pyrrect_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.5, 0.75), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-pyrtri--------------------------------------------------------------
pyrtri <- gen_pyrtri(n = 1000, p = 4)


## -----------------------------------------------------------------------------
pyrtri_lang <- langevitour::langevitour(pyrtri, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----pyrtri-proj1-------------------------------------------------------------
scaled_data <- scale_data_manual(pyrtri)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.3,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.2, 
                                              axis_pos_y = -0.2, 
                                              threshold = 0.022))

pyrtri_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.25, 0.3), 
  title = "b1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrtri-proj2-------------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.3,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.25, 
                                              axis_pos_y = -0.25, 
                                              threshold = 0.03))

pyrtri_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.3, 0.4), 
  title = "b2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrtri-proj3-------------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.4, 
                                              axis_pos_y = -0.4, 
                                              threshold = 0.016))

pyrtri_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.5, 0.62), 
  title = "b3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-pyrstar-------------------------------------------------------------
pyrstar <- gen_pyrstar(n = 1000, p = 4)


## -----------------------------------------------------------------------------
pyrstar_lang <- langevitour::langevitour(pyrstar, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----pyrstar-proj1------------------------------------------------------------
scaled_data <- scale_data_manual(pyrstar)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.022))

pyrstar_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.65, 0.5), 
  title = "c1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrstar-proj2------------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

pyrstar_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.4), 
  title = "c2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrstar-proj3------------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.016))

pyrstar_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.62), 
  title = "c3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-pyrholes------------------------------------------------------------
pyrholes <- gen_pyrfrac(n = 1000, p = 4)


## -----------------------------------------------------------------------------
pyrholes_lang <- langevitour::langevitour(pyrholes, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----pyrholes-proj1-----------------------------------------------------------
scaled_data <- scale_data_manual(pyrholes)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.022))

pyrholes_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.65, 0.7), 
  title = "d1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrholes-proj2-----------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

pyrholes_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.75), 
  title = "d2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyrholes-proj3-----------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.016))

pyrholes_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.62), 
  title = "d3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----pyr, eval=knitr::is_html_output(), fig.cap="Viewing the $4\\text{-}D$  `pyrrect`, `pyrtri`, `pyrstar`, and `pyrholes` data. The `pyrrrect` structure forms a dense rectangular base tapering to a narrow tip, while `pytri` shows a more triangular spread with sharper edges. `Pyrstar` extends into multiple pointed branches radiating from a common core, and `pyrholes` reveals hollow or open regions within an otherwise compact shape.", fig.alt="Interactive langevitour of four $4\\text{-}D$ pyramid-like datasets: pyrrect, pyrtri, pyrstar, and pyrholes, showing dense bases, triangular spreads, branching points, and hollow regions.", fig.pos="!ht"----
# 
# pyrfig <- bscols(
#   htmltools::div(
#     style = "display: grid; grid-template-columns: 1fr 1fr;
#     gap: 0px;
#     align-items: start;
#     justify-items: center;
#     margin: 0;
#     padding: 0;",
#     pyrrect_lang, pyrtri_lang, pyrstar_lang, pyrholes_lang
#   ),
#   device = "xs"
# )
# 
# class(pyrfig) <- c(class(pyrfig), "htmlwidget")
# 
# pyrfig


## ----pyr-proj, eval=knitr::is_latex_output(), fig.cap="Three $2\\text{-}D$ projections from $4\\text{-}D$, for the \\texttt{pyrrect} (a1-a3), \\texttt{pyrtri} (b1-b3), \\texttt{pyrstar} (c1-c3), and \\texttt{pyrholes} (d1-d3) data. The \\texttt{pyrrrect} structure forms a dense rectangular base tapering to a narrow tip, while \\texttt{pytri} shows a more triangular spread with sharper edges. \\texttt{pyrstar} extends into multiple pointed branches radiating from a common core, and \\texttt{pyrholes} reveals hollow or open regions within an otherwise compact shape. These projections illustrate a range of pyramid-like geometries that vary in density and structure.", fig.width=12, fig.height=16, fig.pos="H", out.width="80%", fig.align='center', fig.alt="Three $2\\text{-}D$ projections from each of four $4\\text{-}D$ pyramid-like datasets: pyrrect, pyrtri, pyrstar, and pyrholes, showing their distinct geometries, branching, and hollow regions.", fig.pos="!ht"----

pyrrect_proj1 + pyrrect_proj2 + pyrrect_proj3 +
pyrtri_proj1 + pyrtri_proj2 + pyrtri_proj3 +
pyrstar_proj1 + pyrstar_proj2 + pyrstar_proj3 +
pyrholes_proj1 + pyrholes_proj2 + pyrholes_proj3 +
  plot_layout(ncol = 3, guides = "collect") 


## ----data-scurve--------------------------------------------------------------
scurve <- gen_scurve(n = 1000)


## ----data-circle--------------------------------------------------------------
circle <- gen_circle(n = 1000, p = 4)


## -----------------------------------------------------------------------------
circle_lang <- langevitour::langevitour(circle, levelColors = "black", enableControls = FALSE, width = "260px", height = "170px")


## ----circle-proj1-------------------------------------------------------------
scaled_data <- scale_data_manual(circle)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.022))

circle_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.8, 0.8), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----circle-proj2-------------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

circle_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.7), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----circle-proj3-------------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.016))

circle_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.6, 0.53), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-curvycycle----------------------------------------------------------
curvycycle <- gen_curvycycle(n = 1000, p = 4)


## -----------------------------------------------------------------------------
curvycycle_lang <- langevitour::langevitour(curvycycle, levelColors = "black", enableControls = FALSE, width = "260px", height = "170px")


## ----curvycycle-proj1---------------------------------------------------------
scaled_data <- scale_data_manual(curvycycle)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.022))

curvycycle_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.75, 0.7), 
  title = "b1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----curvycycle-proj2---------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.04))

curvycycle_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.6), 
  title = "b2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----curvycycle-proj3---------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.016))

curvycycle_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.62), 
  title = "b3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-unifsphere----------------------------------------------------------
unifsphere <- gen_unifsphere(n = 1000, r = 1)


## ----data-hollowsphere--------------------------------------------------------
hollowsphere <- gen_hollowsphere(n = 1000, p = 4)


## ----data-clusteredspheres----------------------------------------------------
clusteredspheres <- gen_clusteredspheres(n = c(1000, 100), k = 3, r = c(15, 3),
                                         loc = 10 / sqrt(3)) |>
  dplyr::select(-cluster)


## -----------------------------------------------------------------------------
clusteredspheres_lang <- langevitour::langevitour(clusteredspheres, levelColors = "black", enableControls = FALSE, width = "260px", height = "170px")


## ----clusteredspheres-proj1---------------------------------------------------
scaled_data <- scale_data_manual(clusteredspheres)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097),
  c(0.00896,0.52496,0.12597))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.022))

clusteredspheres_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.75, 0.7), 
  title = "c1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----clusteredspheres-proj2---------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278),
  c(-0.50493,0.14388,0.14615))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

clusteredspheres_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.7), 
  title = "c2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----clusteredspheres-proj3---------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416),
  c(0.50329,0.07199,-0.16064))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.016))

clusteredspheres_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.6, 0.62), 
  title = "c3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----sphere, eval=knitr::is_html_output(), fig.cap="Viewing the $4\\text{-}D$ `circle`, `curvycycle` data, and $3\\text{-}D$ `clusteredspheres` data. The `circle` structure forms a smooth, closed loop, while `curvycycle` shows a wavy, continuous pattern forming a twisted ring. The `clusteredspheres` dataset displays multiple compact spherical groups that are clearly separated in higher dimensions but overlap slightly in some $2\\text{-}D$ projections, highlighting how projection can distort spatial relationships.", fig.alt="Interactive langevitour of three datasets: circle and curvycycle in $4\\text{-}D$ showing closed-loop and wavy twisted-ring structures, and clusteredspheres in 3-D showing multiple compact spherical clusters with slight overlap in projections.", fig.pos="!ht", layout="l-body"----
# 
# spherefig <- bscols(
#   htmltools::div(
#     style = "display: grid; grid-template-columns: 1fr 1fr 1fr;
#     gap: 0px;
#     align-items: start;
#     justify-items: center;
#     margin: 0;
#     padding: 0;",
#     circle_lang, curvycycle_lang, clusteredspheres_lang),
#   #widths=c(3,3,3),
#   device = "xs"
# )
# 
# class(spherefig) <- c(class(spherefig), "htmlwidget")
# 
# spherefig


## ----sphere-proj, eval=knitr::is_latex_output(), fig.cap="Three $2\\text{-}D$ projections from $4\\text{-}D$, \\texttt{circle} (a1-a3), \\texttt{curvycycle} (b1-b3), and, $3\\text{-}D$ \\texttt{clusteredspheres} (c1-c3). The \\texttt{circle} structure forms a smooth, closed loop, while \\texttt{curvycycle} shows a wavy, continuous pattern forming a twisted ring. The \\texttt{clusteredspheres} dataset displays multiple compact spherical groups that are clearly separated in higher dimensions but overlap slightly in some $2\\text{-}D$ projections, highlighting how projection can distort spatial relationships. These projections show how simple cyclic, wavy curvilinear, and clustered structures appear in $2\\text{-}D$, emphasizing the effects of projection on density, continuity, and separation", fig.width=12, fig.height=12, out.width="80%", fig.align='center', fig.pos="H", fig.alt="Three $2\\text{-}D$ projections from each of three datasets: circle, curvycycle, and clusteredspheres, showing closed loops, twisted rings, and compact spherical clusters, illustrating projection effects on structure, density, and separation.", fig.pos="!ht"----

circle_proj1 + circle_proj2 + circle_proj3 +
curvycycle_proj1 + curvycycle_proj2 + curvycycle_proj3  +
clusteredspheres_proj1 + clusteredspheres_proj2 + clusteredspheres_proj3 +
  plot_layout(ncol = 3, guides = "collect") 


## ----data-swissroll-----------------------------------------------------------
swissroll <- gen_swissroll(n = 1000, w = c(-1, 1))


## ----data-trefoil4d-----------------------------------------------------------
trefoil4d <- gen_trefoil4d(n = 500, steps = 5)


## -----------------------------------------------------------------------------
trefoil4d_lang <- langevitour::langevitour(trefoil4d, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----trefoil4d-proj1----------------------------------------------------------
scaled_data <- scale_data_manual(trefoil4d)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.022))

trefoil4d_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.75, 0.7), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----trefoil4d-proj2----------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

trefoil4d_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.65), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----trefoil4d-proj3----------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.55, 
                                              axis_pos_y = -0.55, 
                                              threshold = 0.016))

trefoil4d_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.62), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-trefoil3d-----------------------------------------------------------
trefoil3d <- gen_trefoil3d(n = 500, steps = 5)


## -----------------------------------------------------------------------------
trefoil3d_lang <- langevitour::langevitour(trefoil3d, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----trefoil3d-proj1----------------------------------------------------------
scaled_data <- scale_data_manual(trefoil3d)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097),
  c(0.00896,0.52496,0.12597))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.6, 
                                              axis_pos_y = -0.6, 
                                              threshold = 0.022))

trefoil3d_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.75, 0.7), 
  title = "b1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----trefoil3d-proj2----------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278),
  c(-0.50493,0.14388,0.14615))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

trefoil3d_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.65), 
  title = "b2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----trefoil3d-proj3----------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416),
  c(0.50329,0.07199,-0.16064))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.55, 
                                              axis_pos_y = -0.55, 
                                              threshold = 0.016))

trefoil3d_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.62), 
  title = "b3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----trefoil, eval=knitr::is_html_output(), fig.cap="Viewing the $4\\text{-}D$ `trefoil4d` and $3\\text{-}D$ `trefoil3d` data. The `trefoil4d` structure represents a higher-dimensional extension of the classic trefoil knot, revealing complex twisting and looping patterns that remain continuous across projections. In contrast, the `trefoil3d` dataset maintains a simpler, more compact knot-like form, showing how dimensional extension adds curvature and separation in the embedded space.", fig.alt="Interactive langevitour of two trefoil knot datasets: trefoil4d in $4\\text{-}D$ showing complex twisting and looping patterns, and trefoil3d in 3-D showing a simpler compact knot-like form.", fig.pos="!ht"----
# 
# trefoilfig <- bscols(
#   htmltools::div(
#     style = "display: grid; grid-template-columns: 1fr 1fr;
#     gap: 0px;
#     align-items: start;
#     justify-items: center;
#     margin: 0;
#     padding: 0;",
#     trefoil4d_lang, trefoil3d_lang
#   ),
#   device = "xs"
# )
# 
# class(trefoilfig) <- c(class(trefoilfig), "htmlwidget")
# 
# trefoilfig


## ----trefoil-proj, eval=knitr::is_latex_output(), fig.cap="Three $2\\text{-}D$ projections from $4\\text{-}D$, \\texttt{trefoil4d} (a1-a3) and $3\\text{-}D$ \\texttt{trefoil3d} (b1-b3) data. The \\texttt{trefoil4d} structure represents a higher-dimensional extension of the classic trefoil knot, revealing complex twisting and looping patterns that remain continuous across projections. In contrast, the \\texttt{trefoil3d} dataset maintains a simpler, more compact knot-like form, showing how dimensional extension adds curvature and separation in the embedded space. These projections illustrate a range of looping structures in high-dimensions.", fig.width=12, fig.height=8, fig.pos="H", out.width="80%", fig.align='center', fig.alt="Three $2\\text{-}D$ projections from each of two trefoil knot datasets, showing complex $4\\text{-}D$ trefoil loops and simpler 3-D knot structures, illustrating curvature, twisting, and separation across dimensions.", fig.pos="!ht"----

trefoil4d_proj1 + trefoil4d_proj2 + trefoil4d_proj3 + 
  trefoil3d_proj1 + trefoil3d_proj2 + trefoil3d_proj3 +
  plot_layout(ncol = 3, guides = "collect") 


## ----data-crescent------------------------------------------------------------
crescent <- gen_crescent(n = 1000)


## ----data-curvycylinder-------------------------------------------------------
curvycylinder <- gen_curvycylinder(n = 1000, h = 10)


## -----------------------------------------------------------------------------
curvycylinder_lang <- langevitour::langevitour(curvycylinder, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----curvycylinder-proj1------------------------------------------------------
scaled_data <- scale_data_manual(curvycylinder)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.022))

curvycylinder_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.65, 0.5), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----curvycylinder-proj2------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

curvycylinder_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.6), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----curvycylinder-proj3------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.4, 
                                              axis_pos_y = -0.4, 
                                              threshold = 0.016))

curvycylinder_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.5, 0.5), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-sphericalspiral-----------------------------------------------------
sphericalspiral <- gen_sphericalspiral(n = 1000, spins = 1)


## -----------------------------------------------------------------------------
sphericalspiral_lang <- langevitour::langevitour(sphericalspiral, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----sphericalspiral-proj1----------------------------------------------------
scaled_data <- scale_data_manual(sphericalspiral)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.022))

sphericalspiral_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.65, 0.7), 
  title = "b1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----sphericalspiral-proj2----------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.57, 
                                              axis_pos_y = -0.57, 
                                              threshold = 0.01))

sphericalspiral_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.7, 0.6), 
  title = "b2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----sphericalspiral-proj3----------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.4, 
                                              axis_pos_y = -0.4, 
                                              threshold = 0.016))

sphericalspiral_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.5, 0.5), 
  title = "b3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-helicalspiral-------------------------------------------------------
helicalspiral <- gen_helicalspiral(n = 1000)


## ----data-conicspiral---------------------------------------------------------
conicspiral <- gen_conicspiral(n = 1000, spins = 1)


## -----------------------------------------------------------------------------
conicspiral_lang <- langevitour::langevitour(conicspiral, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----conicspiral-proj1--------------------------------------------------------
scaled_data <- scale_data_manual(conicspiral)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.5, 
                                              axis_pos_y = -0.5, 
                                              threshold = 0.022))

conicspiral_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.65, 0.7), 
  title = "c1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----conicspiral-proj2--------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 3, 
                                              axis_pos_x = -0.65, 
                                              axis_pos_y = -0.65, 
                                              threshold = 0.01))

conicspiral_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.8, 0.5), 
  title = "c2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----conicspiral-proj3--------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.6,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.45, 
                                              axis_pos_y = -0.45, 
                                              threshold = 0.016))

conicspiral_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.6, 0.62), 
  title = "c3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----data-nonlinear-----------------------------------------------------------
nonlinear <- gen_nonlinear(n = 1000, hc = 1, non_fac = 0.5)


## -----------------------------------------------------------------------------
nonlinear_lang <- langevitour::langevitour(nonlinear, levelColors = "black", enableControls = FALSE, width = "400px", height = "300px")


## ----nonlinear-proj1----------------------------------------------------------
scaled_data <- scale_data_manual(nonlinear)

## First projection
projection <- cbind(
  c(0.53506,0.00763,0.00097,-0.10901),
  c(0.00896,0.52496,0.12597,0.08184))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.7,
                                              axis_scaled = 1.2, 
                                              axis_pos_x = -0.3, 
                                              axis_pos_y = -0.3, 
                                              threshold = 0.022))

nonlinear_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.45, 0.73), 
  title = "d1", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----nonlinear-proj2----------------------------------------------------------

## Second projection
projection <- cbind(
  c(-0.06614,0.15134,-0.44278,0.27367),
  c(-0.50493,0.14388,0.14615,0.03486))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.45,
                                              axis_scaled = 1.3, 
                                              axis_pos_x = -0.2, 
                                              axis_pos_y = -0.2, 
                                              threshold = 0.03))

nonlinear_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.3, 0.46), 
  title = "d2", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----nonlinear-proj3----------------------------------------------------------

## Third projection
projection <- cbind(
  c(0.10704,0.04822,-0.03416,0.53224),
  c(0.50329,0.07199,-0.16064,-0.11806))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.2, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 0.45,
                                              axis_scaled = 1.5, 
                                              axis_pos_x = -0.25, 
                                              axis_pos_y = -0.25, 
                                              threshold = 0.016))

nonlinear_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2, "#000000"), # size, alpha, color
  plot_limits = c(-0.35, 0.4), 
  title = "d3", 
  cex = 2, 
  axis_text_size = 5,
  is_color = FALSE)



## ----triginometric, eval=knitr::is_html_output(), fig.cap="Viewing the $4\\text{-}D$ `crescent`, `curvycylinder`, `sphericalspiral`, `helicalspiral`, `conicspiral`, and `nonlinear` data. The `curvycylinder` shows a cylindrical manifold with a nonlinear twist along its height, producing smooth, continuous curvature. The `sphericalspiral` forms a spiral path on a spherical surface, combining circular and vertical motion in a helical form. The `conicspiral` spreads radially while ascending, forming a conical helix with twisting variations in a non-radial dimension. The `nonlinear` dataset exhibits a warped $2\\text{-}D$ surface with sharp oscillations and smooth waves, reflecting complex nonlinear interactions.", fig.alt="Interactive langevitour of six datasets in $4\\text{-}D$: crescent, curvycylinder, sphericalspiral, helicalspiral, conicspiral, and nonlinear, showing cylindrical twists, spiral paths, conical helices, and warped $2\\text{-}D$ surfaces with smooth and sharp variations.", fig.pos="!ht"----
# 
# triginometricfig <- bscols(
#   htmltools::div(
#     style = "display: grid; grid-template-columns: 1fr 1fr;
#     gap: 0px;
#     align-items: start;
#     justify-items: center;
#     margin: 0;
#     padding: 0;",
#     curvycylinder_lang, sphericalspiral_lang, conicspiral_lang, nonlinear_lang
#   ),
#   device = "xs"
# )
# 
# class(triginometricfig) <- c(class(triginometricfig), "htmlwidget")
# 
# triginometricfig


## ----triginometric-proj, eval=knitr::is_latex_output(), fig.cap="Three $2\\text{-}D$ projections from $4\\text{-}D$, for the \\texttt{curvycylinder} (a1-a3), \\texttt{sphericalspiral} (b1-b3), \\texttt{conicspiral} (c1-c3), and \\texttt{nonlinear} (d1-d3) data. The \\texttt{curvycylinder} shows a cylindrical manifold with a nonlinear twist along its height, producing smooth, continuous curvature. The \\texttt{sphericalspiral} forms a spiral path on a spherical surface, combining circular and vertical motion in a helical form. The \\texttt{conicspiral} spreads radially while ascending, forming a conical helix with twisting variations in a non-radial dimension. The \\texttt{nonlinear} dataset exhibits a warped $2\\text{-}D$ surface with sharp oscillations and smooth waves, reflecting complex nonlinear interactions. Each shows variations in curvature, density, and continuity.", fig.width=12, fig.height=16, out.width="70%", fig.align='center', fig.pos="H", fig.alt="Three $2\\text{-}D$ projections from each of four $4\\text{-}D$ datasets: curvycylinder, sphericalspiral, conicspiral, and nonlinear, showing cylindrical twists, spiral and conical helices, and warped $2\\text{-}D$ surfaces, illustrating curvature, density, and continuity.", fig.pos="!ht"----

curvycylinder_proj1 + curvycylinder_proj2 + curvycylinder_proj3 +
sphericalspiral_proj1 + sphericalspiral_proj2 + sphericalspiral_proj3 +
conicspiral_proj1 + conicspiral_proj2 + conicspiral_proj3 +
nonlinear_proj1 + nonlinear_proj2 + nonlinear_proj3 +
  plot_layout(ncol = 3, guides = "collect") 


## -----------------------------------------------------------------------------
noise_fun_tb <- tibble(fun = c("gen_noisedims",
                            "gen_wavydims1",
                            "gen_wavydims2",
                            "gen_wavydims3"), 
                        exp = c("Gaussian noise dimensions with optional mean and standard deviation.",
                                "Wavy noise dimensions based on a user-specified theta sequence with added jitter.",
                                "Wavy noise dimensions using polynomial transformations of an existing dimension vector.",
                                "Wavy noise dimensions using a combination of polynomial and sine transformations based on the first three dimensions of a dataset.")) |> 
  mutate(fun = gsub("_", "\\\\_", fun))


## ----noise-tb-html, eval=knitr::is_html_output()------------------------------
# noise_fun_tb |>
#   mutate(fun = paste0("<code>", fun, "</code>")) |>
#   kable(caption = "cardinalR noise dimensions generation functions", col.names = c("Function", "Explanation"), escape = FALSE, table.pos = "!ht")


## ----noise-tb-pdf, eval=knitr::is_latex_output()------------------------------
noise_fun_tb |> 
  mutate(fun = paste0("\\texttt{", fun, "}")) |> 
  kable(caption = "cardinalR noise dimensions generation functions", format="latex", col.names = c("Function", "Explanation"), escape = FALSE, booktabs = T, table.pos = "!ht")  |>
  column_spec(1, width = "2.5cm") |>
  column_spec(2, width = "10.5cm")


## -----------------------------------------------------------------------------
odd_shapes_tb <- tibble(fun = c("make_mobiusgau",
                                "make_multigau",
                                "make_curvygau",
                                "make_klink_circles",
                                "make_chain_circles",
                                "make_klink_curvycycle",
                                "make_chain_curvycycle",
                                "make_gaucircles",
                                "make_gaucurvycycle",
                                "make_onegrid",
                                "make_twogrid_overlap",
                                "make_twogrid_shift",
                                "make_shape_para"), 
                        exp = c(
    "Möbius-like cluster combined with a Gaussian.",
    "Multiple Gaussian clusters in high-dimensional space.",
    "Curvilinear cluster with a Gaussian cluster.",
    "K-link circular clusters (non-linear circular patterns).",
    "Chain-like circular clusters connected sequentially.",
    "K-link curvy cycle clusters (curvilinear loop structures).",
    "Chain-like curvy cycle clusters connected sequentially.",
    "Circular clusters with a Gaussian cluster in the middle.",
    "Curvy circular clusters with a Gaussian in the middle.",
    "Single grid in two dimensions.",
    "Two overlapping grids.",
    "Two grids shifted relative to each other.",
    "Parallel shaped clusters.")) |> 
  mutate(fun = gsub("_", "\\\\_", fun))


## ----odd-shape-tb-html, eval=knitr::is_html_output()--------------------------
# odd_shapes_tb |>
#   mutate(fun = paste0("<code>", fun, "</code>")) |>
#   kable(caption = "cardinalR multiple clusters generation functions", col.names = c("Function", "Explanation"), linesep = "", escape = FALSE, table.pos = "!ht")


## ----odd-shape-tb-pdf, eval=knitr::is_latex_output()--------------------------
odd_shapes_tb |> 
  mutate(fun = paste0("\\texttt{", fun, "}")) |> 
  kable(caption = "cardinalR multiple clusters generation functions", format="latex", col.names = c("Function", "Explanation"), escape = FALSE, booktabs = T, linesep = "", table.pos = "!ht")  |>
  column_spec(1, width = "3.5cm") |>
  column_spec(2, width = "8.5cm")


## -----------------------------------------------------------------------------
add_fun_tb <- tibble(fun = c("gen_bkgnoise",
                            "randomize_rows",
                            "relocate_clusters",
                            "gen_nproduct",
                            "gen_nsum",
                            "normalize_data"), 
                        exp = c("Adds background noise.",
                                "Randomizes the rows of input data.",
                                "Relocates the clusters.",
                                "Generates a vector of positive integers whose product is approximately equal to a target value.",
                                "Generates a vector of positive integers whose summation is approximately equal to a target value.", 
                                "Normalizes data.")) |> 
  mutate(fun = gsub("_", "\\\\_", fun))


## ----add-tb-html, eval=knitr::is_html_output()--------------------------------
# add_fun_tb |>
#   mutate(fun = paste0("<code>", fun, "</code>")) |>
#   kable(caption = "cardinalR additional functions", col.names = c("Function", "Explanation"), linesep = "", escape = FALSE, table.pos = "!ht")


## ----add-tb-pdf, eval=knitr::is_latex_output()--------------------------------
add_fun_tb |> 
  mutate(fun = paste0("\\texttt{", fun, "}")) |> 
  kable(caption = "cardinalR additional functions", format="latex", col.names = c("Function", "Explanation"), booktabs = T, linesep = "", escape = FALSE, table.pos = "!ht")  |>
  column_spec(1, width = "4cm") |>
  column_spec(2, width = "8cm")


## ----gen-five-clust-data, echo=TRUE-------------------------------------------

positions <- geozoo::simplex(p=4)$points
positions <- positions * 0.3

five_clusts <- gen_multicluster(n = c(2250, 1500, 750, 1250, 1750), k = 5,
                       loc = positions,
                       scale = c(0.25, 0.35, 0.3, 1, 0.3),
                       shape = c("helicalspiral", "hemisphere", "unifcube", 
                                 "cone", "gaussian"),
                       rotation = NULL,
                       is_bkg = FALSE)


## ----highd-data, eval=knitr::is_html_output(), fig.cap="Viewing five synthetic clusters with distinct geometric structures: a helical spiral, a hemisphere, a uniform cube, a cone, and a Gaussian cluster.", fig.alt="Interactive langevitour of five synthetic clusters in $4\\text{-}D$: helical spiral, hemisphere, uniform cube, cone, and Gaussian cluster, each colored distinctly to highlight geometric structure.", fig.pos="!ht"----
# 
# langevitour::langevitour(five_clusts[, -5], group = five_clusts$cluster, levelColors = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e'))


## ----five-clusts-projections1-------------------------------------------------
scaled_data <- scale_data_manual(five_clusts[, -5])

## First projection
projection <- cbind(
  c(-0.59692,0.46414,0.42436,-0.10048),
  c(-0.54999,-0.67673,-0.03631,-0.01193))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.05))

proj_obj1[["cluster"]] <- as.character(five_clusts$cluster)

five_clusts_proj1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")



## ----five-clusts-projections2-------------------------------------------------
## Second projection
projection <- cbind(
  c(0.34673,-0.35774,0.66272,0.27298),
  c(0.24023,0.01170,-0.41886,0.72707))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.07))

proj_obj2[["cluster"]] <- as.character(five_clusts$cluster)

five_clusts_proj2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1.2), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")


## ----five-clusts-projections3-------------------------------------------------
## Third projection
projection <- cbind(
  c(0.47388,-0.20984,-0.56560,0.41644),
  c(-0.51124,-0.60184,0.06463,0.36627))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.05))

proj_obj3[["cluster"]] <- as.character(five_clusts$cluster)

five_clusts_proj3 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1.1), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")



## ----highd-proj, eval=knitr::is_latex_output(), fig.pos="!ht", fig.cap="Three $2\\text{-}D$ projections from $4\\text{-}D$, for the five clusters data. The helical spiral cluster is represented in dark green, the hemisphere cluster in orange, the uniform cube-shaped cluster in purple, the blunted cone cluster in pink, and the Gaussian-shaped cluster in light green.", fig.alt="Three $2\\text{-}D$ projections of five $4\\text{-}D$ synthetic clusters: helical spiral (dark green), hemisphere (orange), uniform cube (purple), cone (pink), and Gaussian (light green), showing spatial separation and cluster geometry.", fig.width=12, fig.height=4, fig.pos="!ht"----

five_clusts_proj1 + five_clusts_proj2 + five_clusts_proj3 +
  plot_layout(ncol = 3) 


## ----layouts------------------------------------------------------------------

tsne_data <- read_rds("data/five_clusts/five_clusts_tsne_perplexity_30.rds") 

nldr1 <- tsne_data |>
  ggplot(aes(x = tSNE1,
             y = tSNE2))+
  geom_point(alpha=0.1, size=1, colour = '#636363') +
  interior_annotation("a", c(0.08, 0.93)) + 
  theme(aspect.ratio = 1) 

umap_data <- read_rds("data/five_clusts/five_clusts_umap_n-neigbors_15_min-dist_0.1.rds") 

nldr2 <- umap_data |>
  ggplot(aes(x = UMAP1,
             y = UMAP2))+
  geom_point(alpha=0.1, size=1, colour = '#d95f02') +
  interior_annotation("b", c(0.08, 0.93)) + 
  theme(aspect.ratio = 1) 

phate_data <- read_rds("data/five_clusts/five_clusts_phate_knn_5.rds") 

nldr3 <- phate_data |>
  ggplot(aes(x = PHATE1,
             y = PHATE2))+
  geom_point(alpha=0.1, size=1, colour = '#7570b3') +
  interior_annotation("c", c(0.08, 0.93)) + 
  theme(aspect.ratio = 1) 

trimap_data <- read_rds("data/five_clusts/five_clusts_trimap_n-inliers_12_n-outliers_4_n-random_3.rds") 

nldr4 <- trimap_data |>
  ggplot(aes(x = TriMAP1,
             y = TriMAP2))+
  geom_point(alpha=0.1, size=1, colour = '#e7298a') +
  interior_annotation("d", c(0.08, 0.93)) + 
  theme(aspect.ratio = 1) 

pacmap_data <- read_rds("data/five_clusts/five_clusts_pacmap_n-neighbors_10_init_random_MN-ratio_0.5_FP-ratio_2.rds") 

nldr5 <- pacmap_data |>
  ggplot(aes(x = PaCMAP1,
             y = PaCMAP2))+
  geom_point(alpha=0.1, size=1, colour = '#66a61e') +
  interior_annotation("e", c(0.08, 0.93)) + 
  theme(aspect.ratio = 1) 

pca_data <- read_rds("data/five_clusts/five_clusts_pca.rds") 

nldr6 <- pca_data |>
  ggplot(aes(x = pca1,
             y = pca2))+
  geom_point(alpha=0.1, size=1, colour = '#a6761d') +
  interior_annotation("f", c(0.08, 0.93)) + 
  theme(aspect.ratio = 1) 


## -----------------------------------------------------------------------------
error_five_clust <- read_rds("data/five_clusts/five_clusts_hbe.rds")

error_five_clust <- error_five_clust |>
  mutate(a1 = round(a1, 2)) |>
  filter(b1 >= 5) |>
  group_by(method, a1) |>
  filter(HBE == min(HBE)) |>
  ungroup()

error_plot_five_clust <- plot_hbe(error_five_clust) +
  scale_x_continuous(breaks = sort(unique(error_five_clust$a1))[c(1, 5, 9, 13, 17, 21, 25)]) +
  scale_color_manual(values=c("tSNE" = '#636363', "UMAP" = '#d95f02', "PHATE" = '#7570b3', "TriMAP" = '#e7298a', "PaCMAP" = '#66a61e', "PCA" = '#a6761d'))


## ----label = "fig-nldr-layouts", fig.pos="H", fig.cap="Assessing which of the 6 NLDR layouts ((a) tSNE, (b) UMAP, (c) PAHTE, (d) TriMAP, (e) PaCMAP, and (f) PCA) of the five clusters data is the better representation using HBE for varying binwidth ($a_1$). Colour is used for the lines and points in the left plot to match the scatterplots of the NLDR layouts (a-f). Layout f is universally poor. Layouts a and b are universally optimal. Layout b shows six well-separated clusters and layout a shows close clusters, thus layout a is the best choice.", fig.alt="Composite plot assessing six NLDR layouts of five clusters data using HBE over varying binwidths, showing tSNE, UMAP, PAHTE, TriMAP, PaCMAP, and PCA. Layouts a and b are optimal, f is poor, with color-coded lines matching the scatterplots of each layout.", fig.pos="!ht"----

error_plot_five_clust + wrap_plots(nldr1, nldr2, nldr3, 
                                    nldr4, nldr5, nldr6, ncol = 2)


## ----label = "fig-cluster-stats", fig.width=10, fig.height=3, out.width="100%", layout="l-body", fig.cap="Cluster validity metrics for solutions with $2–10$ clusters obtained using $k$-means, hierarchical, and model-based clustering. Several indices consistently suggest that $4–5$ clusters provide the best balance of separation and compactness, with $k$-means performing slightly better across metrics."----

# Examine the cluster stats
all_stats <- read_rds("data/five_clusts/cluster_stat.rds")
all_stats |>
  pivot_longer(within.cluster.ss:sindex, names_to = "stat", values_to = "value") |>
  ggplot(aes(x=cl, y=value, colour=method)) +
    geom_line() +
    facet_wrap(~stat, ncol=3, scales="free_y") +
    xlab("Number of clusters") +
    ylab("") +
    scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3')) +
    theme_minimal() +
    theme(panel.border = element_rect(fill = 'transparent'),
          plot.title = element_text(size = 12, hjust = 0.5, vjust = -0.5),
          axis.ticks.x = element_line(),
          axis.ticks.y = element_line(),
          legend.position = "bottom",
          axis.text.x = element_text(size = 7),
          axis.text.y = element_text(size = 7),
          axis.title.x = element_text(size = 7),
          axis.title.y = element_text(size = 7),
          plot.margin = margin(0, 0, 0, 0))


## -----------------------------------------------------------------------------
## k-means with  four clusters
kcl4 <- kmeans(five_clusts[, -5], centers = 4, nstart = 20)$cluster

## k-means with  five clusters
kcl5 <- kmeans(five_clusts[, -5], centers = 5, nstart = 20)$cluster


## ----highd-data-clusters-algo-html, eval=knitr::is_html_output(), fig.cap="Views of the five-cluster synthetic dataset coloured by the $k$-means four- and five-cluster solutions. These show how the five true structures: helical spiral, hemisphere, uniform cube, blunted cone, and Gaussian-shaped cluster appear under $k$-means partitions. Both the $4$- and $5$-cluster solutions mix colours, revealing substantial misclassification and limited ability of $k$-means to recover the underlying geometric structure.", fig.pos="!ht", layout = "l-body"----
# 
# four_km_langevitour <- langevitour::langevitour(
#   five_clusts[, -5],
#   group = kcl4,
#   levelColors = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e'),
#   width = "350px",
#   height = "300px"
# )
# 
# five_km_langevitour <- langevitour::langevitour(
#   five_clusts[, -5],
#   group = kcl5,
#   levelColors = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e'),
#   width = "350px",
#   height = "300px"
# )
# 
# km_results <- browsable(
#   div(
#     style = "
#       display: flex;
#       justify-content: space-between;
#       gap: 5px;
#     ",
#     div(style = "flex: 1;", four_km_langevitour),
#     div(style = "flex: 1;", five_km_langevitour)
#   )
# )
# 
# class(km_results) <- c(class(km_results), "htmlwidget")
# 
# km_results


## ----five-4clusts-projections1------------------------------------------------
scaled_data <- scale_data_manual(five_clusts[, -5])

## First projection
projection <- cbind(
  c(-0.59692,0.46414,0.42436,-0.10048),
  c(-0.54999,-0.67673,-0.03631,-0.01193))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.05))

proj_obj1[["cluster"]] <- as.character(kcl4)

five_clusts_proj1_1 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")



## ----five-4clusts-projections2------------------------------------------------
## Second projection
projection <- cbind(
  c(0.34673,-0.35774,0.66272,0.27298),
  c(0.24023,0.01170,-0.41886,0.72707))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.07))

proj_obj2[["cluster"]] <- as.character(kcl4)

five_clusts_proj2_1 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1.2), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")


## ----five-4clusts-projections3------------------------------------------------
## Third projection
projection <- cbind(
  c(0.47388,-0.20984,-0.56560,0.41644),
  c(-0.51124,-0.60184,0.06463,0.36627))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.05))

proj_obj3[["cluster"]] <- as.character(kcl4)

five_clusts_proj3_1 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1.1), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")



## ----five-5clusts-projections1------------------------------------------------
scaled_data <- scale_data_manual(five_clusts[, -5])

## First projection
projection <- cbind(
  c(-0.59692,0.46414,0.42436,-0.10048),
  c(-0.54999,-0.67673,-0.03631,-0.01193))

proj_obj1 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.05))

proj_obj1[["cluster"]] <- as.character(kcl5)

five_clusts_proj1_2 <- plot_proj(
  proj_obj = proj_obj1, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1), 
  title = "a1", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")



## ----five-5clusts-projections2------------------------------------------------
## Second projection
projection <- cbind(
  c(0.34673,-0.35774,0.66272,0.27298),
  c(0.24023,0.01170,-0.41886,0.72707))

proj_obj2 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.07))

proj_obj2[["cluster"]] <- as.character(kcl5)

five_clusts_proj2_2 <- plot_proj(
  proj_obj = proj_obj2, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1.2), 
  title = "a2", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")


## ----five-5clusts-projections3------------------------------------------------
## Third projection
projection <- cbind(
  c(0.47388,-0.20984,-0.56560,0.41644),
  c(-0.51124,-0.60184,0.06463,0.36627))

proj_obj3 <- get_projection(projection = projection, 
                            proj_scale = 1.23, 
                            scaled_data = scaled_data, 
                            axis_param = list(limits = 1,
                                              axis_scaled = 0.8, 
                                              axis_pos_x = -0.9, 
                                              axis_pos_y = -0.9, 
                                              threshold = 0.05))

proj_obj3[["cluster"]] <- as.character(kcl5)

five_clusts_proj3_2 <- plot_proj(
  proj_obj = proj_obj3, 
  point_param = c(1.5, 0.2), # size, alpha, color
  plot_limits = c(-1.1, 1.1), 
  title = "a3", 
  cex = 2, 
  axis_text_size = 4,
  is_color = TRUE) + scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a','#66a61e')) +
  theme(legend.position = "none")



## ----highd-proj-clust-algo-pdf, eval=knitr::is_latex_output(), fig.pos="!ht", fig.cap="Three $2\\text{-}D$ projections from $4\\text{-}D$, for the five clusters data coloured by the $k$-means four- (a1-a3) and five-cluster (b1-b3) solutions. The intermixing of colours within each projection reflects misclassification in both solutions, showing the difficulty of using $k$-means to capture the dataset’s nonlinear and heterogeneous shapes.", fig.width=12, fig.height=8, fig.pos="!ht"----

five_clusts_proj1_1 + five_clusts_proj2_1 + five_clusts_proj3_1 +
  five_clusts_proj1_2 + five_clusts_proj2_2 + five_clusts_proj3_2 +
  plot_layout(ncol = 3) 

